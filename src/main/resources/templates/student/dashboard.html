<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Academic Information System</title>
    <link rel="stylesheet" th:href="@{/css/student-style.css}">
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="navbar-content">
        <a href="/student/dashboard" class="navbar-brand">Academic Information System</a>
        <div class="navbar-right">
            <div class="user-info">
                <div class="user-icon">
                    <span th:text="${#strings.substring(currentUser, 0, 1)}">S</span>
                </div>
                <span class="user-name" th:text="${currentUser}">Student</span>
            </div>
            <a href="/logout" class="btn-logout">Logout</a>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="container">
    <!-- Welcome Card -->
    <section class="welcome-card">
        <h2>Welcome back, <span th:text="${currentUser}">Student</span></h2>
        <p>View your academic performance and grades.</p>
        <div th:if="${student.group != null}">
            <span class="info-badge">
                Group: <span th:text="${student.group.groupName}">CS-2024-1</span>
            </span>
        </div>
    </section>

    <!-- Statistics -->
    <section class="stats-grid" aria-label="Academic statistics">
        <article class="stat-card">
            <div class="stat-header">
                <div class="stat-label">Total Grades</div>
                <div class="stat-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                </div>
            </div>
            <div class="stat-value" th:text="${stats.totalGrades}">0</div>
        </article>

        <article class="stat-card">
            <div class="stat-header">
                <div class="stat-label">Average Grade</div>
                <div class="stat-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                </div>
            </div>
            <div class="stat-value" th:text="${stats.averageGrade != null ? #numbers.formatDecimal(stats.averageGrade, 1, 2) : '0.0'}">0.0</div>
        </article>

        <article class="stat-card">
            <div class="stat-header">
                <div class="stat-label">Passing Grades</div>
                <div class="stat-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
            </div>
            <div class="stat-value" th:text="${stats.passingGrades}">0</div>
        </article>

        <article class="stat-card">
            <div class="stat-header">
                <div class="stat-label">Failing Grades</div>
                <div class="stat-icon">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
            </div>
            <div class="stat-value" th:text="${stats.failingGrades}">0</div>
        </article>
    </section>

    <!-- My Grades -->
    <section class="grades-section">
        <div class="section-header">
            <h2>My Grades</h2>
        </div>

        <!-- Filter by Subject -->
        <form method="get" th:action="@{/student/dashboard}" class="filter-form">
            <label for="subjectFilter">Filter by Subject:</label>
            <select name="subjectId" id="subjectFilter" onchange="this.form.submit()">
                <option value="" th:selected="${selectedSubjectId == null}">All Subjects</option>
                <option th:each="sub : ${subjects}"
                        th:value="${sub.subjectId}"
                        th:text="${sub.subjectName}"
                        th:selected="${selectedSubjectId == sub.subjectId}">
                </option>
            </select>
        </form>

        <div th:if="${grades != null && !grades.isEmpty()}">
            <div class="average-display">
                <span class="average-label">Your Overall Average</span>
                <span class="average-value" th:text="${stats.averageGrade != null ? #numbers.formatDecimal(stats.averageGrade, 1, 2) : '0.0'}">0.0</span>
            </div>

            <div class="table-container">
                <table role="table" aria-label="Grades list">
                    <thead>
                    <tr>
                        <th scope="col">Subject</th>
                        <th scope="col">Code</th>
                        <th scope="col">Teacher</th>
                        <th scope="col">Grade</th>
                        <th scope="col">Date</th>
                        <th scope="col">Comments</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="grade : ${grades}">
                        <td th:text="${grade.assignment.subject.subjectName}">Object-Oriented Programming</td>
                        <td>
                            <span class="badge badge-primary" th:text="${grade.assignment.subject.subjectCode}">CS201</span>
                        </td>
                        <td th:text="${grade.assignment.teacher.fullName}">John Smith</td>
                        <td>
                            <span th:class="${grade.gradeValue >= 5.0 ? 'badge badge-success' : 'badge badge-danger'}"
                                  th:text="${grade.gradeValue}">9.5</span>
                        </td>
                        <td th:text="${#temporals.format(grade.gradeDate, 'yyyy-MM-dd')}">2024-11-15</td>
                        <td th:text="${grade.comments != null ? grade.comments : '-'}">Excellent work</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div th:if="${grades == null || grades.isEmpty()}" class="no-grades">
            <div class="no-grades-icon">
                <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
            </div>
            <h3>No Grades Yet</h3>
            <p>You don't have any grades yet. Check back later!</p>
        </div>
    </section>
</main>
</body>
</html>